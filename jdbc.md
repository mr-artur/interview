# JDBC
+ [Что такое _«JDBC»_?](#Что-такое-JDBC)
+ [Для чего нужен _JDBC_?](#Для-чего-нужен-JDBC)
+ [Архитектура _JDBC_](#Архитектура-JDBC)
+ [`DriverManager`](#DriverManager)
+ [Драйверы](#Драйверы)
    + [Типы драйверов](#Типы-драйверов)
    + [Какой тип драйвера выбрать?](#Какой-тип-драйвера-выбрать?)
+ [`Connection`](#Connection)
    + [Регистрация драйвера](#Регистрация-драйвера)
    + [Передача-информации-о-БД](#Передача-информации-о-БД)
    + [Создание-соединения](#Создание-соединения)
    + [Закрытие-соединения](#Закрытие-соединения)

## Что такое _«JDBC»_?
+ _JDBC_ (Java Database Connectivity) - это стандартный API для работы с разными базами данных в языке Java.
+ Для работы с конкретной базой данных необходимо установить специальный драйвер для нее, котоырый является адаптером Java-приложения под конкретную БД.
+ _JDBC_ входит в стандартную библиотеку Java. Его классы находятся в пакетах `java.sql` и `javax.sql`.

[к оглавлению](#JDBC)

## Для чего нужен _JDBC_?
_JDBC_ решает следующие задачи :
+ Создание соединения с БД.
+ Создание _SQL_ - выражений.
+ Выполнение _SQL_ - запросов.
+ Получение данных из базы, их обновление, удаление, а также вставка новых.

[к оглавлению](#JDBC)

## Архитектура _JDBC_
+ Архитектура _JDBC_ может быть как `2` - х звенной, так и `3` - х звенной, но в общем случае она состоит из `2` - х слоев :
    + JDBC API - обеспечивает соединение приложения с JDBC Manager.
    + JDBC Driver API - обеспечивает соединение JDBC Manager с драйвером.
+ JDBC API использует менеджер драйверов и специальные драйверы БД для обеспечения подключения к базам данных.
+ JDBC Manager проверяет соответствие драйвера с конкретной БД. Он поддерживает использование нескольких драйверов одновременно для одновременной работы с несколькими БД.

Схематично JDBC можно представить в таком виде :

![alt text](https://pro-java.ru/wp-content/uploads/2015/03/JDBC-Architecture.gif)

[к оглавлению](#JDBC)

## `DriverManager`
+ `DriverManager` - это ключевая сущность JDBC, которая управляет списком драйверов БД. 
+ `DriverManager` позволяет нам указывать ему, какие драйвера необходимо загрузить в его список.
+ `DriverManager` также позволяет устанавливать соединение с базами данных с помощью вызова `DriverManager.getConnection`, который принимает в качестве аргументов параметры подключения. `DriverManager` смотрит на `URL`, переданный как аргумент, и опрашивает имеющиеся драйверы в поиске подходящего. После он устанавливает соединение с БД с помощью ПЕРВОГО подошедшего по урлу драйвера.

[к оглавлению](#JDBC)

## Драйверы
+ _Драйвер_ - это сущность, которая непосредственно отвечает за взаимодействие с опреденной БД. Работать нам с ней приходится крайне редко, так как вместо этого мы используем объекты `DriverManager`, которые управляют драйверами.
+ Именно драйвер дает нам возможность открывать соединения, выполнять `SQL` - запросы и т.п.
+ Чтобы БД могла работать с _JDBC_, ее разработчики должны написать соответствующую имплементацию интерфейса `java.sql.Driver`.

[к оглавлению](#JDBC)

## Типы драйверов
+ ___Тип 1_. JDBC - ODBC транслятор__.
    + Этот тип драйвера транслирует JDBC в установленный на каждой клиентской машине ODBC (Open Database Connectivity). Использование ODBC требует конфигурации DSN, который является целевой БД.
    + Схема работы JDBC - ODBC транслятора :
    
        ![alt text](https://i0.wp.com/proselyte.net/wp-content/uploads/2016/03/jdbc-driver-type1.jpg?resize=300%2C254&ssl=1)
    + Изначально, именно этот тип драйверов был самым используемым, так как большинство БД поддерживало только ODBC.

+ ___Тип 2_. JDBC - нативный API__.
    + В этом драйвере JDBC API преобразовывается в уникальный для каждой БД нативный C/C++ API. 
    + Его принцип работы довольно схож с драйвером первого типа.
    + Схема работы JDBC - нативный API драйвера :
    
        ![alt text](https://i0.wp.com/proselyte.net/wp-content/uploads/2016/03/jdbc-driver-type2.jpg?resize=300%2C254&ssl=1)
    + Если мы меняем БД, то нам необходимо изменить и нативный API, который будет работать с конкретной БД.
    
+ ___Тип 3_. JDBC - Драйвер на основе библиотеки Java__.
    + Этот тип драйверов использует трехзвенный подход для получения доступа к БД.
    + Для связи с промежуточным сервером используется стандартный сетевой сокет. Информация, полученная от этого сокета, транслируется промежуточным сервером в формат, который необходим конкретной БД и направляется в сервер БД.
    + Схема работы JDBC - Драйвера на основе библиотеки Java : 
        
        ![alt text](https://i2.wp.com/proselyte.net/wp-content/uploads/2016/03/jdbc-driver-type3.jpg?resize=300%2C227&ssl=1)
    + Этот подход является крайне гибким, так как нет необходимости устанавливать ПО на стороне клиента и один драйвер способен обеспечить доступ к различным БД.

+ ___Тип 4_. Чистая Java__.
    + Этот тип драйверов разработан полностью с использованием языка программирования Java и работает с БД через сокетное соединение.
    + Главное преимущество такого драйвера - это наибольшая производительность, и обычно такие драйверы предоставляются разработчиками БД.
    + Схема работы драйвера на чистой Java :
    
        ![alt text](https://i2.wp.com/proselyte.net/wp-content/uploads/2016/03/jdbc-driver-type4.jpg?resize=300%2C275&ssl=1)   
    + Еще одно преимущество такого типа драйвера - это невероятная гибкость. Нам не нужно устанавливать никакого дополнительного программного обеспечения.
    + Ярким примером такого драйвера является _MySQL Connector/J_.

[к оглавлению](#JDBC)

## Какой тип драйвера выбрать?
+ Когда мы работаем с такими БД, как MySQL, Oracle и т.д., наиболее предпочтительным будет использования драйвера типа `4`.
+ Если наше приложение использует различные виды БД, то тип `3` будет более приемлемым.
+ Если для нашей БД еще нет драйверов `3` или `4`, то мы будем вынуждены использовать драйвер под номером `2`.
+ Драйвер типа `1` обычно не используется в коммерческой разработке.   

[к оглавлению](#JDBC) 

## `Connection`
`Connection` - это тип объектов соединения с базой данных. Он создается с помощью перегруженного метода `DriverManager.getConnection()` и позволяет нам выполнять `SQL` - запросы.

Для того, чтобы установить соединение с базой банных, необходимо выполнить `3` шага :
1. Зарегистрировать JDBC драйвер.
2. Передать информацию для соединения с БД (URL, имя пользователя и пароль) - шаг фактически общий с третим.
3. Создать соединение с помощью `DriverManager.getConnection()`.

[к оглавлению](#JDBC) 

### Регистрация драйвера
Регистрацию драйвера можно осуществить `2` - мя способами :
##### 1. С помощью статического метода `DriverManager.registerDriver()`.

В коде это выглядит так :
```java
try {
    Driver driver = new com.mysql.jdbc.Driver();
    DriverManager.registerDriver(driver);
} catch (SQLException e) {
    System.out.println("Unable to load driver class.");
    e.printStackTrace();
}
```

##### 2. С помощью `Class.forName()`.

Этот способ является более распространенным. Мы используем `Class.forName()` для динамической загрузки класса драйвера в память, после чего происходит его автоматическая регистрация. 

Данный способ является более предпочтительным, так как он обеспечивает конфигурируемую и переносимую регистрацию драйверов.

В коде он выглядит так :
```java
try {
    Class.forName("com.mysql.jdbc.Driver");
} catch (ClassNotFoundException e) {
    System.out.println("Unable to load class.");
    e.printStackTrace();
}
```

[к оглавлению](#JDBC) 

### Передача информации о БД
После того, как мы зарегистрировали наш драйвер, мы можем установить соединение с помощью метода `DriverManager.getConnection()`.

Этот метод имеет `3` перегруженных варианта :
+ `getConnection(String url)`
+ `getConnection(String url, Properties props)`
+ `getConnection(String url, String user, String password)`

Как видим, каждый из этих методов требует URL нашей БД. Поэтому, нам необходимо передавать информацию о БД.

URL для разных баз данных будет различен, так же как и драйвер. Например :
+ MySQL : URL : `jdbc:mysql://hostname/databaseName`, Driver name : `jdbc:mysql://hostname/databaseName`.
+ Oracle : URL : `jdbc:oracle:thin:@hostname:portNumber/databaseName`, Driver name : `oracle.jdbc.driver.OracleDriver`.

[к оглавлению](#JDBC) 

### Создание соединения
После того, как мы зарегистрировали драйвер и передали всю необходимую информацию о БД, мы можем создать физическое соединение с БД.

Пример создания соединения с БД MySQL :
```java
String URL = "jdbc:mysql://localhost/exampledb";
String USER = "root";
String PASSWORD = "root";
Connection connection = DriverManger.getConnection(URL, USER, PASSWORD);
```

[к оглавлению](#JDBC) 

### Закрытие соединения
После того, как мы закончим программу, необходимо закрыть все соединения и освободить ресурсы. Если мы не сделаем это вручную, это сделает сборщик мусора при уничтожении объектов, которые не используются.

Но полагаться на сборщик мусора - это крайне плохая идея и дурной тон.

Можно закрыть соединение либо явно (так делали раньше в блоке `final`) :
```java
connection.close();
```
Либо более современным способом - использовать автоматическое освобождение ресурсов с помощью конструкции `try-with-resources` :
```java
try (Connection connection = DriverManager.getConnection(URL, USERNAME, PASSWORD)) {
    ...
}
```

[к оглавлению](#JDBC)
